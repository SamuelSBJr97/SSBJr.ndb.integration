<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="SSBJr.ndb.integration.ApiManagerPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="Gerenciador de APIs">
    
    <ScrollView>
        <VerticalStackLayout Spacing="25" Padding="30,0" VerticalOptions="Center">
            
            <!-- Header -->
            <Label 
                x:Name="TitleLabel"
                Text="Gerenciador de APIs"
                FontSize="32"
                HorizontalOptions="Center"
                TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}" />

            <Label 
                Text="Gerencie suas APIs hospedadas"
                FontSize="18" 
                HorizontalOptions="Center"
                TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray200}}" />

            <!-- Nova API Form -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}"
                   HasShadow="True">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Nova API" FontSize="20" FontAttributes="Bold" />
                    
                    <Entry x:Name="ApiNameEntry" 
                           Placeholder="Nome da API"
                           Text="{Binding ApiName}" />
                    
                    <Entry x:Name="ApiDescriptionEntry" 
                           Placeholder="Descrição da API"
                           Text="{Binding ApiDescription}" />
                    
                    <Button x:Name="UploadFileBtn"
                            Text="Selecionar Arquivo Swagger JSON"
                            Clicked="OnUploadFileClicked" 
                            BackgroundColor="{StaticResource Secondary}" />
                    
                    <Label x:Name="FileStatusLabel" 
                           Text="Nenhum arquivo selecionado"
                           FontSize="12"
                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray200}}" />
                    
                    <Button x:Name="CreateApiBtn"
                            Text="Criar API"
                            Clicked="OnCreateApiClicked"
                            BackgroundColor="{StaticResource Primary}"
                            IsEnabled="False" />
                </VerticalStackLayout>
            </Frame>

            <!-- APIs List -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}"
                   HasShadow="True">
                <VerticalStackLayout Spacing="15">
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="APIs Hospedadas" FontSize="20" FontAttributes="Bold" HorizontalOptions="FillAndExpand" />
                        <Button x:Name="RefreshBtn"
                                Text="Atualizar"
                                Clicked="OnRefreshClicked"
                                BackgroundColor="{StaticResource Tertiary}" />
                    </HorizontalStackLayout>
                    
                    <ActivityIndicator x:Name="LoadingIndicator" IsVisible="True" IsRunning="True" />
                    
                    <CollectionView x:Name="ApisCollectionView" ItemsSource="{Binding Apis}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="10" RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="*,Auto">
                                    
                                    <!-- API Name and Description -->
                                    <Label Grid.Row="0" Grid.Column="0" 
                                           Text="{Binding Name}" 
                                           FontAttributes="Bold" 
                                           FontSize="16" />
                                    
                                    <!-- Status Badge -->
                                    <Frame Grid.Row="0" Grid.Column="1"
                                           BackgroundColor="{Binding StatusColor}"
                                           CornerRadius="12"
                                           Padding="8,4">
                                        <Label Text="{Binding Status}" 
                                               TextColor="White"
                                               FontSize="12"
                                               FontAttributes="Bold" />
                                    </Frame>
                                    
                                    <!-- Description -->
                                    <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding Description}" 
                                           FontSize="14"
                                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray200}}" />
                                    
                                    <!-- Dates -->
                                    <Label Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding CreatedAtFormatted}" 
                                           FontSize="12"
                                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray200}}" />
                                    
                                    <!-- Actions -->
                                    <HorizontalStackLayout Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" 
                                                         Spacing="5" Margin="0,10,0,0">
                                        
                                        <!-- Start/Stop Button -->
                                        <Button Text="{Binding ActionButtonText}"
                                                BackgroundColor="{Binding ActionButtonColor}"
                                                Clicked="OnApiActionClicked"
                                                CommandParameter="{Binding .}" />
                                        
                                        <!-- Health Check Button -->
                                        <Button Text="Verificar"
                                                BackgroundColor="{StaticResource Tertiary}"
                                                Clicked="OnHealthCheckClicked"
                                                CommandParameter="{Binding .}" />
                                        
                                        <!-- Delete Button -->
                                        <Button Text="Deletar"
                                                BackgroundColor="Red"
                                                Clicked="OnDeleteClicked"
                                                CommandParameter="{Binding .}" />
                                    </HorizontalStackLayout>
                                    
                                    <!-- Separator -->
                                    <BoxView Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                                             Color="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                                             HeightRequest="1" 
                                             Margin="0,10,0,0" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    
                    <Label x:Name="EmptyStateLabel" 
                           Text="Nenhuma API hospedada ainda."
                           HorizontalTextAlignment="Center"
                           FontSize="16"
                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray200}}"
                           IsVisible="False" />
                </VerticalStackLayout>
            </Frame>

            <!-- Status Messages -->
            <Label x:Name="StatusLabel" 
                   IsVisible="False"
                   HorizontalTextAlignment="Center"
                   FontSize="14" />

        </VerticalStackLayout>
    </ScrollView>
    
</ContentPage>