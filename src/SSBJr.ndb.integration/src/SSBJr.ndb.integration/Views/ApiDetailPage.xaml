<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="SSBJr.ndb.integration.Views.ApiDetailPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SSBJr.ndb.integration.ViewModels"
             x:DataType="viewmodels:ApiDetailViewModel"
             Title="📊 Detalhes da API"
             Shell.BackgroundColor="{StaticResource Primary}">

    <ScrollView>
        <StackLayout Padding="20" Spacing="20">

            <!-- Header -->
            <Frame BackgroundColor="{StaticResource Primary}" 
                   CornerRadius="15" 
                   Padding="20"
                   HasShadow="True">
                <StackLayout>
                    <Label Text="{Binding ApiName, StringFormat='📊 {0}'}"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalOptions="Center" />
                    <Label Text="{Binding ApiDescription}"
                           FontSize="14"
                           TextColor="White"
                           Opacity="0.8"
                           HorizontalOptions="Center" />
                    <Frame BackgroundColor="White"
                           CornerRadius="20"
                           Padding="10,5"
                           Margin="0,10,0,0"
                           HorizontalOptions="Center">
                        <Label Text="{Binding StatusText}"
                               TextColor="{Binding StatusColor}"
                               FontAttributes="Bold" />
                    </Frame>
                </StackLayout>
            </Frame>

            <!-- Quick Stats -->
            <Frame BackgroundColor="White" 
                   CornerRadius="15" 
                   Padding="20"
                   HasShadow="True">
                <StackLayout>
                    <Label Text="📈 Estatísticas Rápidas"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}" />

                    <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,*" RowSpacing="15" ColumnSpacing="15" Margin="0,15,0,0">
                        
                        <!-- Response Time -->
                        <Frame Grid.Row="0" Grid.Column="0" BackgroundColor="{StaticResource Success}" CornerRadius="10" Padding="15">
                            <StackLayout>
                                <Label Text="⏱️" FontSize="24" HorizontalOptions="Center" />
                                <Label Text="{Binding ResponseTime, StringFormat='{0}ms'}" FontSize="18" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center" />
                                <Label Text="Tempo Resposta" FontSize="12" TextColor="White" HorizontalOptions="Center" />
                            </StackLayout>
                        </Frame>

                        <!-- Requests Today -->
                        <Frame Grid.Row="0" Grid.Column="1" BackgroundColor="{StaticResource Primary}" CornerRadius="10" Padding="15">
                            <StackLayout>
                                <Label Text="📊" FontSize="24" HorizontalOptions="Center" />
                                <Label Text="{Binding RequestsToday}" FontSize="18" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center" />
                                <Label Text="Requests Hoje" FontSize="12" TextColor="White" HorizontalOptions="Center" />
                            </StackLayout>
                        </Frame>

                        <!-- Uptime -->
                        <Frame Grid.Row="1" Grid.Column="0" BackgroundColor="{StaticResource Secondary}" CornerRadius="10" Padding="15">
                            <StackLayout>
                                <Label Text="⬆️" FontSize="24" HorizontalOptions="Center" />
                                <Label Text="{Binding Uptime}" FontSize="18" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center" />
                                <Label Text="Uptime" FontSize="12" TextColor="White" HorizontalOptions="Center" />
                            </StackLayout>
                        </Frame>

                        <!-- Error Rate -->
                        <Frame Grid.Row="1" Grid.Column="1" BackgroundColor="{Binding ErrorRateColor}" CornerRadius="10" Padding="15">
                            <StackLayout>
                                <Label Text="❌" FontSize="24" HorizontalOptions="Center" />
                                <Label Text="{Binding ErrorRate, StringFormat='{0:F1}%'}" FontSize="18" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center" />
                                <Label Text="Taxa de Erro" FontSize="12" TextColor="White" HorizontalOptions="Center" />
                            </StackLayout>
                        </Frame>
                    </Grid>
                </StackLayout>
            </Frame>

            <!-- Infrastructure Status -->
            <Frame BackgroundColor="White" 
                   CornerRadius="15" 
                   Padding="20"
                   HasShadow="True">
                <StackLayout>
                    <Label Text="🏗️ Status da Infraestrutura"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}" />

                    <!-- Database Status -->
                    <Grid Margin="0,15,0,10" ColumnDefinitions="Auto,*,Auto">
                        <Label Grid.Column="0"
                               Text="🗄️"
                               FontSize="20"
                               VerticalOptions="Center" />
                        <StackLayout Grid.Column="1" Margin="15,0,0,0">
                            <Label Text="{Binding DatabaseTypeName}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Primary}" />
                            <Label Text="{Binding DatabaseStatus}"
                                   FontSize="12"
                                   TextColor="Gray" />
                        </StackLayout>
                        <Label Grid.Column="2"
                               Text="{Binding DatabaseStatusIcon}"
                               FontSize="20"
                               VerticalOptions="Center" />
                    </Grid>

                    <!-- Messaging Status -->
                    <Grid Margin="0,10" ColumnDefinitions="Auto,*,Auto"
                          IsVisible="{Binding HasMessaging}">
                        <Label Grid.Column="0"
                               Text="📨"
                               FontSize="20"
                               VerticalOptions="Center" />
                        <StackLayout Grid.Column="1" Margin="15,0,0,0">
                            <Label Text="{Binding MessagingTypeName}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Primary}" />
                            <Label Text="{Binding MessagingStatus}"
                                   FontSize="12"
                                   TextColor="Gray" />
                        </StackLayout>
                        <Label Grid.Column="2"
                               Text="{Binding MessagingStatusIcon}"
                               FontSize="20"
                               VerticalOptions="Center" />
                    </Grid>

                    <!-- Cache Status -->
                    <Grid Margin="0,10" ColumnDefinitions="Auto,*,Auto"
                          IsVisible="{Binding HasCache}">
                        <Label Grid.Column="0"
                               Text="💾"
                               FontSize="20"
                               VerticalOptions="Center" />
                        <StackLayout Grid.Column="1" Margin="15,0,0,0">
                            <Label Text="{Binding CacheTypeName}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Primary}" />
                            <Label Text="{Binding CacheStatus}"
                                   FontSize="12"
                                   TextColor="Gray" />
                        </StackLayout>
                        <Label Grid.Column="2"
                               Text="{Binding CacheStatusIcon}"
                               FontSize="20"
                               VerticalOptions="Center" />
                    </Grid>
                </StackLayout>
            </Frame>

            <!-- Actions -->
            <Frame BackgroundColor="White" 
                   CornerRadius="15" 
                   Padding="20"
                   HasShadow="True">
                <StackLayout>
                    <Label Text="🔧 Ações"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}" />

                    <StackLayout Spacing="10" Margin="0,15,0,0">
                        <Button Text="⚙️ Configurar Infraestrutura"
                                Command="{Binding ConfigureInfrastructureCommand}"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="White"
                                CornerRadius="8" />

                        <Button Text="📈 Ver Métricas Detalhadas"
                                Command="{Binding ViewMetricsCommand}"
                                BackgroundColor="{StaticResource Secondary}"
                                TextColor="White"
                                CornerRadius="8" />

                        <Button Text="📋 Ver Logs"
                                Command="{Binding ViewLogsCommand}"
                                BackgroundColor="{StaticResource Warning}"
                                TextColor="White"
                                CornerRadius="8" />

                        <StackLayout Orientation="Horizontal" Spacing="10">
                            <Button Text="🚀 Deploy"
                                    Command="{Binding DeployCommand}"
                                    BackgroundColor="Green"
                                    TextColor="White"
                                    CornerRadius="8"
                                    HorizontalOptions="FillAndExpand"
                                    IsVisible="{Binding CanDeploy}" />

                            <Button Text="⏹️ Parar"
                                    Command="{Binding StopCommand}"
                                    BackgroundColor="Red"
                                    TextColor="White"
                                    CornerRadius="8"
                                    HorizontalOptions="FillAndExpand"
                                    IsVisible="{Binding CanStop}" />

                            <Button Text="🔄 Reiniciar"
                                    Command="{Binding RestartCommand}"
                                    BackgroundColor="Orange"
                                    TextColor="White"
                                    CornerRadius="8"
                                    HorizontalOptions="FillAndExpand"
                                    IsVisible="{Binding CanRestart}" />
                        </StackLayout>
                    </StackLayout>
                </StackLayout>
            </Frame>

        </StackLayout>
    </ScrollView>

</ContentPage>